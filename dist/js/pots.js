/**
 * @license AGPLv3
 * SPDX-License-Identifier: AGPLv3
 * SPDX-FileCopyrightText: Copyright (c) 2026 The Guitar Wiring Visualizer Authors
 */
import{DiagramState}from"./diagram.js";import{Component,Pin}from"./coreComponents.js";import{EventDispatcher,Events}from"./events.js";export class Potentiometer extends Component{constructor(t={}){super(t),this.state.rotation=this.state.rotation||-1,this._updatePinConnections()}static get ImageURL(){return"/img/pot-gr.svg"}static get _pinsStartAtX(){return 25}static get _pinsStartAtY(){return 110}static get _centerPoint(){return[50,50]}static get pinConnectionNodeName(){return"pot-pin-connection"}get rotation(){return this.state.rotation}set rotation(t){this.state.rotation=t,this._updatePinConnections()}get pin3(){return DiagramState.instance.getComponent(this.pinIds.at(0))}get wiperPin(){return DiagramState.instance.getComponent(this.pinIds.at(1))}get pin1(){return DiagramState.instance.getComponent(this.pinIds.at(2))}get groundPin(){return DiagramState.instance.getComponent(this.pinIds.at(3))}rotate(t){this.rotation=-this.rotation,this._updatePinConnections(),this._reDrawPinConnections(t),EventDispatcher.instance.dispatch(Events.PotRotated,this._createBaseEventArgs())}_createChildComponents(){for(let t=0;t<3;t++){const n=new Pin;this.pinIds.push(n.id),n.moveTo({x:Potentiometer._pinsStartAtX+24*t,y:Potentiometer._pinsStartAtY})}const t=new Pin;this.pinIds.push(t.id),t.moveTo({x:77,y:64})}_updatePinConnections(){this.wiperPin.disconnectFromOtherPin(),-1===this.rotation?this.wiperPin.connectToOtherPin(this.pin3):1===this.rotation&&this.wiperPin.connectToOtherPin(this.pin1)}async _drawChildNodes(t){this.pin1.draw(t),this.pin3.draw(t),this.wiperPin.draw(t),this.groundPin.draw(t),Konva.Image.fromURL(Potentiometer.ImageURL,n=>(this._applyGlobalStyling(n),t.add(n),this._getPinNodes(t).forEach(t=>t.zIndex(n.zIndex())),this._drawPinConnections(t),Promise.resolve()))}_reDrawPinConnections(t){t.find("."+Potentiometer.pinConnectionNodeName).forEach(t=>{t.destroy()}),this._drawPinConnections(t)}_getOuterPinById(t){return t===this.pin1.id?this.pin1:(this.pin3.id,this.pin3)}_drawPinConnections(t){const n=this.wiperPin.findNode(t).position(),i=this._getOuterPinById(this.wiperPin.connectedPinId).findNode(t).position(),e=[n.x,n.y-16,...this.constructor._centerPoint,i.x,i.y-23],o=new Konva.Line({name:Potentiometer.pinConnectionNodeName,opacity:DiagramState.instance.showInternals?1:0,strokeWidth:5,stroke:"#939393",lineJoin:"round",lineCap:"round",perfectDrawEnable:!1,points:e});t.add(o)}}
